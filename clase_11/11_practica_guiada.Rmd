---
title:  Minería de Textos
output:
  html_notebook:
    toc: yes
    toc_float: yes
date: ""
subtitle: Práctica Guiada
---

```{r warning=FALSE}
library(tidyverse)
library(ggthemes)
library(sf)
```




#### 

```{r}
radios <- st_read("https://bitsandbricks.github.io/data/CABA_rc.geojson")
```


```{r}
summary(radios)
```

```{r}
ggplot() + geom_sf(data = radios)
```

```{r}
ggplot() + geom_sf(data = radios, aes(fill = VIVIENDAS)) 
ggplot() + geom_sf(data = radios, aes(fill = POBLACION), color = NA)
```


```{r}
ggplot() + geom_sf(data = radios, aes(fill = BARRIO), color = NA)+
  theme(legend.position = 'none')
```

```{r}
ggplot() + 
    geom_sf(data = radios, aes(fill = POBLACION/AREA_KM2), color = NA) +
    scale_fill_viridis_c() +
    labs(title = "Densidad de población",
         subtitle = "Ciudad Autónoma de Buenos Aires",
         fill = "hab/km2")
```


#### Barrios

Si queremos reconstruir los polígonos de los barrios, sólo necesitamos hacer un `group_by` y un `summarise` y automáticamente la columna `geometry` crea el polígono combinado. Además podemos hacer una agregación de las demás variables.

```{r}
glimpse(radios)

barrios_geo <- radios %>% 
    group_by(BARRIO) %>% 
    summarise(POBLACION = sum(POBLACION),
              VIVIENDAS = sum(VIVIENDAS),
              HOGARES = sum(HOGARES),
              HOGARES_NBI = sum(HOGARES_NBI),
              AREA_KM2 = sum(AREA_KM2))

glimpse(barrios_geo)
```


```{r fig.height=12, fig.width=10}
ggplot() +
    geom_sf(data = barrios_geo, aes(fill = POBLACION/AREA_KM2), color = NA) +
    geom_sf_text(data = barrios_geo %>% 
                   filter(POBLACION/AREA_KM2>25000), aes(label = BARRIO), size=3)+
  theme(legend.position = 'bottom')+
    scale_fill_viridis_c(option = 'C') +
    labs(title = "Densidad de población",
         subtitle = "Ciudad Autónoma de Buenos Aires",
         fill = "hab/km2")+
    theme_void()
```


#### Volcando en el mapa información de múltiples fuentes

```{r}
subte_lineas <- st_read("http://bitsandbricks.github.io/data/subte_lineas.geojson")
glimpse(subte_lineas)
```

```{r}
subte_estaciones <- st_read("http://bitsandbricks.github.io/data/subte_estaciones.geojson")
glimpse(subte_estaciones)
```


```{r fig.height=10, fig.width=7}
ggplot() +
    geom_sf(data = barrios_geo, aes(fill = HOGARES_NBI/HOGARES), color = NA) +
    geom_sf(data = subte_lineas, color = "yellow") +
    geom_sf(data = subte_estaciones, color = "orange") +
  theme(legend.position = 'bottom')+
  scale_fill_viridis_c()+
    labs(title = "Sistema de transporte subterráneo (SUBTE)",
         subtitle = "Ciudad de Buenos Aires")
```



### Mapeo de Palos borrachos rosados en Buenos Aires

![](img/Palo borracho rosado.jpg){width=500}

```{r}
palos_borrachos <- read_rds('../fuentes/arbolado_palo_borracho.rds')


palos_borrachos %>% 
  sample_n(10)
```




```{r}
palos_borrachos <- st_as_sf(palos_borrachos, coords = c('long','lat') )%>% 
  st_set_crs(4326)
glimpse(palos_borrachos)
glimpse(subte_estaciones)
```

```{r fig.height=7, fig.width=7}
ggplot() +
  geom_sf(data = barrios_geo) +
  geom_sf(data = palos_borrachos, color = "darkgreen", size=.5) +
  labs(title = 'localización de los palos borrachos de Buenos Aires')+
  theme_void()+
  theme(legend.position = 'none')
```

